<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Graph Transformations Test</title>
    <!-- Plotly for rendering graphs -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel to compile JSX -->
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .question-container {
        margin-bottom: 20px;
      }
      .choices {
        list-style-type: none;
        padding: 0;
      }
      .choice {
        margin: 10px 0;
      }
      .graph-container {
        width: 100%;
        height: 400px;
        margin-bottom: 15px;
      }
      .button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      // A React component that renders a Plotly graph.
      // The equation prop should be a function (e.g., x => (x - 1)**2 + 3)
      function Graph({ equation }) {
        const graphRef = React.useRef(null);

        React.useEffect(() => {
          const xValues = [];
          const yValues = [];
          for (let x = -10; x <= 10; x += 0.1) {
            xValues.push(x);
            yValues.push(equation(x));
          }
          const trace = {
            x: xValues,
            y: yValues,
            mode: 'lines',
            name: 'Graph'
          };
          const layout = {
            margin: { t: 20 },
            xaxis: { title: 'x', zeroline: true },
            yaxis: { title: 'y', zeroline: true }
          };
          Plotly.newPlot(graphRef.current, [trace], layout);
        }, [equation]);

        return <div className="graph-container" ref={graphRef}></div>;
      }

      // The main test app component.
      function GraphTestApp() {
        // Define an array of questions.
        // Question types: 'text' (just text-based multiple choice)
        // and 'graph' (renders a Plotly graph with the question)
        const questions = [
          {
            id: 1,
            type: 'text',
            prompt:
              "Which of the following equations best represents a graph that is the result of shifting y = x² two units to the right?",
            choices: [
              { id: 'A', text: "y = (x - 2)²" },
              { id: 'B', text: "y = (x + 2)²" },
              { id: 'C', text: "y = x² + 2" },
              { id: 'D', text: "y = x² - 2" }
            ],
            correct: 'A'
          },
          {
            id: 2,
            type: 'graph',
            prompt:
              "Look at the graph below. Which equation corresponds to it?",
            // For this question, we use an equation function to render the graph.
            // Here, we are displaying the graph of y = (x - 1)² + 3.
            equation: (x) => (x - 1) ** 2 + 3,
            choices: [
              { id: 'A', text: "y = (x - 1)²" },
              { id: 'B', text: "y = (x + 1)²" },
              { id: 'C', text: "y = (x - 1)² + 3" },
              { id: 'D', text: "y = (x - 1)² - 3" }
            ],
            correct: 'C'
          }
        ];

        const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
        const [selectedChoice, setSelectedChoice] = React.useState('');
        const [score, setScore] = React.useState(0);
        const [showFeedback, setShowFeedback] = React.useState(false);
        const [feedback, setFeedback] = React.useState('');
        const [completed, setCompleted] = React.useState(false);

        const currentQuestion = questions[currentQuestionIndex];

        const handleChoiceChange = (e) => {
          setSelectedChoice(e.target.value);
        };

        const handleSubmit = () => {
          if (selectedChoice === '') return;

          if (selectedChoice === currentQuestion.correct) {
            setScore(score + 1);
            setFeedback("Correct!");
          } else {
            setFeedback(
              "Incorrect. The correct answer was " + currentQuestion.correct
            );
          }
          setShowFeedback(true);
        };

        const handleNext = () => {
          setShowFeedback(false);
          setSelectedChoice('');
          if (currentQuestionIndex + 1 < questions.length) {
            setCurrentQuestionIndex(currentQuestionIndex + 1);
          } else {
            setCompleted(true);
          }
        };

        const handleRestart = () => {
          setCurrentQuestionIndex(0);
          setSelectedChoice('');
          setScore(0);
          setShowFeedback(false);
          setCompleted(false);
        };

        return (
          <div>
            <h1>Graph Transformations Test</h1>
            {completed ? (
              <div>
                <h2>Test Completed!</h2>
                <p>
                  Your score: {score} / {questions.length}
                </p>
                <button className="button" onClick={handleRestart}>
                  Restart Test
                </button>
              </div>
            ) : (
              <div className="question-container">
                <h2>Question {currentQuestionIndex + 1}</h2>
                <p>{currentQuestion.prompt}</p>
                {currentQuestion.type === 'graph' && (
                  <Graph equation={currentQuestion.equation} />
                )}
                <ul className="choices">
                  {currentQuestion.choices.map((choice) => (
                    <li key={choice.id} className="choice">
                      <label>
                        <input
                          type="radio"
                          value={choice.id}
                          checked={selectedChoice === choice.id}
                          onChange={handleChoiceChange}
                        />
                        {choice.text}
                      </label>
                    </li>
                  ))}
                </ul>
                {!showFeedback ? (
                  <button
                    className="button"
                    onClick={handleSubmit}
                    disabled={selectedChoice === ''}
                  >
                    Submit Answer
                  </button>
                ) : (
                  <div>
                    <p>{feedback}</p>
                    <button className="button" onClick={handleNext}>
                      Next Question
                    </button>
                  </div>
                )}
              </div>
            )}
          </div>
        );
      }

      ReactDOM.render(<GraphTestApp />, document.getElementById("root"));
    </script>
  </body>
</html>
